{% extends "base.html" %}

{% block title %}Modern Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-grid">
        <!-- Metric Cards -->
        <div class="card metric-card">
            <div class="metric-icon total-stock"><i class="fas fa-box"></i></div>
            <div class="metric-info">
                <h3>{{ metrics.total_stock }}</h3>
                <p>Total Stock</p>
            </div>
        </div>
        <div class="card metric-card">
            <div class="metric-icon low-stock"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="metric-info">
                <h3>{{ metrics.low_stock_items }}</h3>
                <p>Low Stock Items</p>
            </div>
        </div>
        <div class="card metric-card">
            <div class="metric-icon suppliers"><i class="fas fa-truck"></i></div>
            <div class="metric-info">
                <h3>{{ metrics.total_suppliers }}</h3>
                <p>Suppliers</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card quick-actions">
            <div class="card-header">
                <h2 class="card-title">Quick Actions</h2>
            </div>
            <a href="{{ url_for('main.inventory') }}?action=generate-po" class="button create">Generate PO</a>
            <a href="{{ url_for('main.inventory') }}?action=receive-stock" class="button">Receive Stock</a>
        </div>

        <!-- Reports -->
        <div class="card reports-list">
            <div class="card-header">
                <h2 class="card-title">Reports</h2>
            </div>
            <a href="{{ url_for('main.low_stock_report') }}" class="report-item">
                <span>Low Stock Report</span>
                <i class="fas fa-chevron-right"></i>
            </a>
            <a href="{{ url_for('main.stock_ledger') }}" class="report-item">
                <span>Stock Ledger</span>
                <i class="fas fa-chevron-right"></i>
            </a>
            <a href="{{ url_for('main.suppliers') }}" class="report-item">
                <span>Supplier Ledger</span>
                <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <!-- Stock Trend Chart -->
        <div class="card chart-container">
            <div class="card-header">
                <h2 class="card-title">Stock Trend (Last 30 Days)</h2>
            </div>
            <canvas id="stockTrendChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch("{{ url_for('api.stock_trend_data') }}")
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('stockTrendChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Stock Quantity',
                            data: data.values,
                            backgroundColor: 'rgba(108, 99, 255, 0.2)',
                            borderColor: 'rgba(108, 99, 255, 1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
    });
</script>
{% endblock %}
