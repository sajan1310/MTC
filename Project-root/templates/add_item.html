{% extends "base.html" %}

{% block title %}Add New Item - MTC App{% endblock %}

{% block content %}
<div class="container">
    <h1 class="main-title">Add New Item</h1>
    <form id="item-form" class="form-layout" method="POST" action="{{ url_for('add_item') }}" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-section">
            <h2 class="section-title">Item Details</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="item-name">Item Name</label>
                    <input type="text" id="item-name" name="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="item-model">Model</label>
                    <input type="text" id="item-model" name="model" class="form-control">
                </div>
                <div class="form-group">
                    <label for="item-variation">Variation</label>
                    <input type="text" id="item-variation" name="variation" class="form-control">
                </div>
                <div class="form-group full-width">
                    <label for="item-description">Description</label>
                    <textarea id="item-description" name="description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="item-image">Item Image</label>
                    <input type="file" id="item-image" name="image" class="form-control">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">Item Variants</h2>
            <div id="variants-container">
                <table class="variants-table">
                    <thead>
                        <tr>
                            <th>Color</th>
                            <th>Size</th>
                            <th>Opening Stock</th>
                            <th>Threshold</th>
                            <th>Unit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="variants-list-container">
                        <tr id="variants-placeholder">
                            <td colspan="6" class="text-center">No variants added yet.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button type="button" id="add-variant-btn" class="button secondary mt-4">Add Variant</button>
        </div>

        <div class="form-actions">
            <button type="submit" class="button primary">Save Item</button>
            <a href="{{ url_for('main.inventory') }}" class="button">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addVariantBtn = document.getElementById('add-variant-btn');
        const variantsList = document.getElementById('variants-list-container');
        const placeholder = document.getElementById('variants-placeholder');

        function updatePlaceholder() {
            if (variantsList.children.length > 1) { // 1 because placeholder is a child
                placeholder.style.display = 'none';
            } else {
                placeholder.style.display = 'table-row';
            }
        }

        addVariantBtn.addEventListener('click', function() {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" name="color" class="form-control" required></td>
                <td><input type="text" name="size" class="form-control" required></td>
                <td><input type="number" name="opening_stock" class="form-control" value="0" min="0"></td>
                <td><input type="number" name="threshold" class="form-control" value="5" min="0"></td>
                <td><input type="text" name="unit" class="form-control" value="Pcs"></td>
                <td><button type="button" class="button cancel small remove-variant-btn">Remove</button></td>
            `;
            variantsList.appendChild(newRow);
            updatePlaceholder();
        });

        variantsList.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-variant-btn')) {
                e.target.closest('tr').remove();
                updatePlaceholder();
            }
        });

        updatePlaceholder();
    });
</script>
{% endblock %}
