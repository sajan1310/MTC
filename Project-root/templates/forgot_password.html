<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot password</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="login-page">
    <div class="login-container card">
        <div class="login-header">
            <a href="{{ url_for('auth.login') }}" class="link" aria-label="Back to login">
                ‚Üê Back to login
            </a>
            <h1 class="login-title">Reset your password</h1>
            <p class="login-subtitle">Enter your email to receive reset instructions</p>
        </div>

        <form id="forgot-form" class="login-form" autocomplete="on">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="you@company.com" required autofocus>
            </div>
            <button id="forgot-btn" type="submit" class="btn primary full">Send reset link</button>
        </form>

        <p id="forgot-msg" class="muted" aria-live="polite" style="margin-top:12px;"></p>
    </div>

    <script>
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const forgotForm = document.getElementById('forgot-form');
    const forgotBtn = document.getElementById('forgot-btn');
    const forgotMsg = document.getElementById('forgot-msg');

    forgotForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        if (!email) { forgotMsg.textContent = 'Email is required.'; return; }

        forgotBtn.disabled = true;
        const original = forgotBtn.textContent;
        forgotBtn.textContent = 'Sending...';
        forgotMsg.textContent = '';

        try {
            const res = await fetch('/api/forgot-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ email })
            });
            const data = await res.json().catch(() => ({}));
            const msg = data.message || 'If an account exists for that email, a reset link will be sent.';
            forgotMsg.textContent = msg;
        } catch (err) {
            forgotMsg.textContent = 'If an account exists for that email, a reset link will be sent.';
        } finally {
            forgotBtn.disabled = false;
            forgotBtn.textContent = original;
        }
    });
    </script>
</body>
</html>
