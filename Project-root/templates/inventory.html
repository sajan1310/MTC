{% extends "base.html" %}
{% block title %}Inventory Management{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card" style="padding: 1.5rem;">
        <!-- Enhanced Page Header with Search -->
        <div class="page-header">
            <div class="header-left">
                <h2>Inventory Management</h2>
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <input type="text" 
                               id="inventory-search" 
                               class="search-input" 
                               placeholder="Search items by name, model, or variation..."
                               autocomplete="off">
                        <button type="button" class="clear-search-btn" style="display: none;" title="Clear search">Ã—</button>
                    </div>
                    <div id="search-result-count" class="search-result-count">
                        Showing all items
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button id="add-item-btn" class="button create">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                    Add New Item
                </button>
            </div>
        </div>
        
        <!-- Enhanced Inventory Table -->
        <div class="inventory-table-container">
            <div class="table-wrapper">
                <table class="inventory-table compact">
                    <thead>
                        <tr>
                            <th class="expand-col" title="Expand/Collapse Details"></th>
                            <th class="id-col">Photo</th>
                            <th class="name-col">Item Name</th>
                            <th class="model-col">Model</th>
                            <th class="variation-col">Variation</th>
                            <th class="variants-col">Variants</th>
                            <th class="stock-col">Total Stock</th>
                            <th class="status-col">Status</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-table-body">
                        <!-- Item rows will be dynamically populated here by app.js -->
                        <tr class="loading-row">
                            <td colspan="9" style="text-align: center; padding: 2rem;">
                                <div class="loading-spinner">
                                    <div class="spinner"></div>
                                    <span>Loading inventory...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



<!-- Enhanced Loading States and Progress Indicators -->
<div id="global-loading" class="global-loading" style="display: none;">
    <div class="loading-content">
        <div class="loading-spinner large">
            <div class="spinner"></div>
        </div>
        <p>Processing your request...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Enhanced search functionality with debouncing
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('inventory-search');
    const clearSearchBtn = document.querySelector('.clear-search-btn');
    
    if (searchInput && clearSearchBtn) {
        // Show/hide clear button based on input
        searchInput.addEventListener('input', function() {
            if (this.value.trim()) {
                clearSearchBtn.style.display = 'block';
            } else {
                clearSearchBtn.style.display = 'none';
            }
        });
        
        // Clear search functionality
        clearSearchBtn.addEventListener('click', function() {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
            this.style.display = 'none';
        });
        
        // Enhanced keyboard navigation
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
                this.dispatchEvent(new Event('input'));
                this.blur();
            }
        });
    }
    
    // Enhanced modal accessibility
    const modal = document.getElementById('add-edit-item-modal');
    if (modal) {
        modal.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const closeBtn = modal.querySelector('.close-modal-btn');
                if (closeBtn) closeBtn.click();
            }
        });
    }
    
    // Auto-expand textareas
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    });
});
</script>
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}

{% block extra_head %}
<style>
/* Enhanced responsive styles for inventory page */
@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .header-left {
        width: 100%;
    }
    
    .search-container {
        width: 100%;
    }
    
    .search-input-wrapper {
        width: 100%;
    }
    
    .header-actions {
        width: 100%;
        justify-content: center;
    }
    
    .inventory-table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .inventory-table {
        min-width: 800px;
    }
    
    .modal-content.large {
        width: 95%;
        margin: 1rem auto;
        max-height: 90vh;
    }
    
    .form-row {
        flex-direction: column;
    }
    
    .form-field {
        min-width: auto !important;
    }
}

/* Print styles */
@media print {
    .page-header,
    .header-actions,
    .actions-col,
    .expand-col {
        display: none !important;
    }
    
    .inventory-table {
        width: 100% !important;
        font-size: 12px;
    }
    
    .form-card {
        box-shadow: none !important;
        border: 1px solid #000;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .status-badge {
        border: 2px solid currentColor;
    }
    
    .search-input {
        border: 2px solid currentColor;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .loading-spinner .spinner {
        animation: none;
    }
    
    .modal,
    .search-input-wrapper {
        transition: none;
    }
}
</style>
{% endblock %}
